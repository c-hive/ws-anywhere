<!DOCTYPE html>
    <head>
        <meta charset="UTF-8">
        <title>ws-anywhere</title>
        <style>
            body {
                text-align: center;
            }

            input, textarea {
                display: block;
                margin: 10px auto;
                padding: 10px 15px;
            }

            input[name="periodInSeconds"] {
                padding: 10px 5px;
            }

            button {
                margin: 5px;
                padding: 5px 10px;
                background: none;
                outline: none;
            }
        </style>
    </head>
    <body>
        <h1>ws-anywhere</h1>
        <h2>Customizable WebSocket test server</h2>
        <p>WebSocket connections can only be established on the index route.</p>
        <p>The objects are serialized as the WebSocket API doens't support sending raw objects. As a result, the received dummy data in the client side is stringified by <i>JSON.stringify()</i>.</p>
        <h3>How to use?</h3>
        <p>There are two different ways to use the server:
        <div>
            <h4>1. PER REQUEST</h4>
            <p>This is evoked whenever the server receives <i>send</i> events.</p>
            <textarea id="perRequestData" rows="10" cols="80" placeholder="Place the desired dummy response data here."></textarea>
            <button type="button" id="perRequestButton" onclick="postPerRequestSettings()">Confirm</button>
        </div>
        <div>
            <h4>2. PERIODIC</h4>
            <p>The period of the intervals is customizable. As a side note, this occurs immediately after connecting to the server - depending on the interval you set.</p>
            <textarea id="periodicData" rows="10" cols="80" placeholder="Place the desired dummy response data here."></textarea>
            <input id="periodInSeconds" type="number" style="width: 150px;" placeholder="Period in seconds" min="1" />
            <button type="button" id="periodicButton" onclick="postPeriodicSettings()">Confirm</button>
        </div>

        <script>
            const pageUrl = window.location.href;

            window.onload = function() {
                const getUrl = pageUrl + "settings/current";
                fetch(getUrl)
                    .then(res => res.json())
                    .then(parsedResponse =>Â {
                        setInputValues(parsedResponse);
                    });
            }

            function objectIsNotEmpty(object) {
                return Object.keys(object).length !== 0;
            }

            function setInputValues(data) {
                const oneSecondInMilliseconds = 1000;

                if (objectIsNotEmpty(data.currentSettings.perRequest.dummyData)) {
                    document.getElementById("perRequestData").value = JSON.stringify(data.currentSettings.perRequest.dummyData, undefined, 2);
                }

                if (objectIsNotEmpty(data.currentSettings.periodic.dummyData)) {
                    document.getElementById("periodicData").value = data.currentSettings.periodic.dummyData;
                    document.getElementById("periodInSeconds").value = data.currentSettings.periodic.intervalInMilliseconds / oneSecondInMilliseconds;
                }
            }

            function postPerRequestSettings() {
                const dummyData = document.getElementById("perRequestData").value;
                const postUrl = pageUrl + 'settings/perrequestdata';

                fetch(postUrl, {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "POST",
                    body: dummyData,
                })
                .then(res => res.json())
                .then(parsedResponse => {
                    if (parsedResponse.success) {
                        setInputValues(parsedResponse);
                    }
                });
            }

            function postPeriodicSettings() {
                const dummyData = document.getElementById("periodicData").value;
                const periodInSeconds = document.getElementById("periodInSeconds").value;
                const postUrl = pageUrl + 'settings/periodicdata';

                const data = {
                    dummyData,
                    periodInSeconds,
                };

                fetch(postUrl, {
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    method: "POST",
                    body: JSON.stringify(data),
                })
                .then(res => res.json())
                .then(parsedResponse => {
                    if (parsedResponse.success) {
                        setInputValues(parsedResponse);
                    }
                });
            }
        </script>
    </body>
</html>